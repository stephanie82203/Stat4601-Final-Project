---
title: "Data Cleaning for Unsupervised Learning"
author: "Stephanie Cheng"
date: "2025-04-08"
output: pdf_document
---

```{r libraries, include=FALSE}
library(here)
library(dplyr)
```

```{r setup}
#Getting the datasets from the Excel files
manhattan_data<-readxl::read_xlsx(
  here::here("data","rollingsales_manhattan.xlsx")) |>
  janitor::clean_names()
bronx_data<-readxl::read_xlsx(
  here::here("data","rollingsales_bronx.xlsx")) |>
  janitor::clean_names()
brooklyn_data<-readxl::read_xlsx(
  here::here("data","rollingsales_brooklyn.xlsx")) |>
  janitor::clean_names()
queens_data<-readxl::read_xlsx(
  here::here("data","rollingsales_queens.xlsx")) |>
  janitor::clean_names()
staten_island_data<-readxl::read_xlsx(
  here::here("data","rollingsales_statenisland.xlsx")) |>
  janitor::clean_names()

#Column Names are the 4th row
col_names<-make.names(c(manhattan_data[4,]))

#The Information in row 1 to 3 are descriptions of the dataset, 
#and are not needed in the dataframe, 
#the 4th row is the column names and can also be removed
manhattan_data<-manhattan_data[-c(1:4),]
bronx_data<-bronx_data[-c(1:4),]
brooklyn_data<-brooklyn_data[-c(1:4),]
queens_data<-queens_data[-c(1:4),]
staten_island_data<-staten_island_data[-c(1:4),]

#The column names are the same for all datasets,
#so we can use the same vector for all of them
colnames(manhattan_data)<-col_names
colnames(bronx_data)<-col_names
colnames(brooklyn_data)<-col_names
colnames(queens_data)<-col_names
colnames(staten_island_data)<-col_names
```

```{r cleaning}
clean_data <- function(data) {
  data %>%
    filter(SALE.PRICE != 0) %>%
    select(
      -NEIGHBORHOOD, -BLOCK, -LOT, -EASEMENT, 
      -ADDRESS, -APARTMENT.NUMBER, -SALE.DATE) %>%
    mutate(
      BOROUGH= as.numeric(BOROUGH), 
      BUILDING.CLASS.CATEGORY= as.numeric(as.factor(BUILDING.CLASS.CATEGORY)), 
      TAX.CLASS.AT.PRESENT= as.numeric(as.factor(TAX.CLASS.AT.PRESENT)), 
      BUILDING.CLASS.AT.PRESENT= as.numeric(
        as.factor(BUILDING.CLASS.AT.PRESENT)), 
      ZIP.CODE= as.numeric(ZIP.CODE), 
      RESIDENTIAL.UNITS= as.numeric(RESIDENTIAL.UNITS), 
      COMMERCIAL.UNITS= as.numeric(COMMERCIAL.UNITS), 
      TOTAL.UNITS= as.numeric(TOTAL.UNITS), 
      LAND.SQUARE.FEET= as.numeric(LAND.SQUARE.FEET), 
      GROSS.SQUARE.FEET= as.numeric(GROSS.SQUARE.FEET), 
      YEAR.BUILT= as.numeric(YEAR.BUILT), 
      TAX.CLASS.AT.TIME.OF.SALE= as.numeric(
        as.factor(TAX.CLASS.AT.TIME.OF.SALE)), 
      BUILDING.CLASS.AT.TIME.OF.SALE= as.numeric(
        as.factor(BUILDING.CLASS.AT.TIME.OF.SALE)),
      SALE.PRICE = as.numeric(SALE.PRICE)
    ) %>%
    na.omit()
}
manhattan_data <- clean_data(manhattan_data)
bronx_data <- clean_data(bronx_data)
brooklyn_data <- clean_data(brooklyn_data)
queens_data <- clean_data(queens_data)
staten_island_data <- clean_data(staten_island_data)
```

```{r combine}
new_york_city_data <- rbind(manhattan_data, bronx_data, brooklyn_data, 
                            queens_data, staten_island_data)
```

```{r save}
save(manhattan_data, file = "manhattan_data.RData")
save(bronx_data, file = "bronx_data.RData")
save(brooklyn_data, file = "brooklyn_data.RData")
save(queens_data, file = "queens_data.RData")
save(staten_island_data, file = "staten_island_data.RData")
save(new_york_city_data, file = "new_york_city_data.RData")
```

